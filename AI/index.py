import os
import sys
from dotenv import load_dotenv
import google.generativeai as genai
from Utils.logging import logger

class AI:
    def __init__(self):
        try:
            load_dotenv()
            api_key = os.getenv("GEMINI_API_KEY")
            genai.configure(api_key=api_key)
            self.model = genai.GenerativeModel('gemini-pro')
        except Exception as e:
            logger.write(f"Error initializing AI: {str(e)}", is_exception=True)

    def process_input(self, input):
        try:
            prompt = f"""
            Analyze the following vehicle data and create an extensive, detailed 5000 wordreport:

            {input}

            Generate a comprehensive human-readable, 5000 wordreport on this vehicle. Follow these guidelines:

            1. Thoroughly examine all provided data points (there may be 69+ fields).
            2. Structure the report into logical sections, but be flexible based on available data.
            3. For each data point:
               - Explain its significance in plain language
               - Provide context or comparisons where relevant
               - Note any changes or trends if multiple values are given
            4. Highlight any unusual or noteworthy information.
            5. If certain expected information is missing, mention its absence.
            6. Use natural language and a knowledgeable, professional tone.
            7. Provide detailed analysis and insights wherever possible.
            8. Include all relevant information, no matter how minor it may seem.

            Potential sections to cover (adjust based on available data):
            - Vehicle Overview (make, model, year, registration)
            - Technical Specifications
            - History and Ownership
            - MOT and Maintenance History
            - Performance and Condition
            - Environmental Factors
            - Financial Aspects (tax, potential costs)
            - Unusual Features or Circumstances
            - Overall Assessment

            The report should be extensive, utilizing all provided data points to paint a complete picture of the vehicle. Aim for a thorough, multi-paragraph report that a potential buyer or vehicle inspector would find informative and comprehensive.
            """
            
            response = self.model.generate_content(prompt)
            return response.text
        except Exception as e:
            logger.write(f"Error processing input: {str(e)}", is_exception=True)

if __name__ == "__main__":
    try:
        ai = AI()
        
        # Example usage
        input = """
        {"ak03eww": {"basicDetails_vrm": [{"value": "AK03EWW", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_make": [{"value": "FORD", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_model": [{"value": "RANGER", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_colour": [{"value": "White", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_fuelType": [{"value": "Diesel", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_doors": [{"value": "2", "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_engineSize": [{"value": 2499, "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_mileage": [{"value": 64883, "created_at": "2024-10-01T18:02:08.251577"}, {"value": 64916, "created_at": "2024-10-03T05:01:22.486566"}], "basicDetails_motStatusId": [{"value": 1, "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_manufactureDate": [{"value": 1049068800.0, "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_motDueDate": [{"value": 1754956800.0, "created_at": "2024-10-01T18:02:08.251577"}], "basicDetails_lastV5CIssueDate": [{"value": 1727049600.0, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_hasPlateChanges": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_hasColourChanges": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_hasSalvageRecords": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_hasMileageAnomaly": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_isExported": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_likelyFailureItem": [{"value": null, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_likelyFailureValue": [{"value": null, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_isPossibleTaxi": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "provenance_taxiStatusId": [{"value": 0, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_registration": [{"value": "AK03EWW", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_make": [{"value": "FORD", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_model": [{"value": "RANGER", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_year": [{"value": "2003", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_age": [{"value": 21, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_monthOfFirstRegistration": [{"value": "2003-03", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_averageMilesPy": [{"value": "3012", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_primaryColour": [{"value": "White", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_engineCapacity": [{"value": 2499, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_co2Emissions": [{"value": 0, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_typeApproval": [{"value": "N1", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_revenueWeight": [{"value": 2650, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_wheelplan": [{"value": "2 AXLE RIGID BODY", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_specs_price": [{"value": 4450, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_motTests": [{"completedDate": "2024.08.13 08:40:46", "testResult": "PASSED", "expiryDate": "2025.08.12", "odometerValue": "63250", "odometerUnit": "mi", "motTestNumber": "142729447006"}, {"completedDate": "2022.09.06 15:19:27", "testResult": "PASSED", "expiryDate": "2023.09.05", "odometerValue": "59869", "odometerUnit": "mi", "motTestNumber": "810153384735"}, {"completedDate": "2022.08.11 15:43:45", "testResult": "FAILED", "odometerValue": "59866", "odometerUnit": "mi", "motTestNumber": "439343630162"}, {"completedDate": "2022.03.23 11:21:17", "testResult": "FAILED", "odometerValue": "59628", "odometerUnit": "mi", "motTestNumber": "872403936992"}, {"completedDate": "2021.04.08 09:04:13", "testResult": "PASSED", "expiryDate": "2022.04.10", "odometerValue": "56631", "odometerUnit": "mi", "motTestNumber": "495231075004"}, {"completedDate": "2021.04.08 09:04:12", "testResult": "FAILED", "odometerValue": "56631", "odometerUnit": "mi", "motTestNumber": "477334366889"}, {"completedDate": "2020.03.20 12:18:51", "testResult": "PASSED", "expiryDate": "2021.04.10", "odometerValue": "54512", "odometerUnit": "mi", "motTestNumber": "994152204217"}, {"completedDate": "2020.03.20 12:18:50", "testResult": "FAILED", "odometerValue": "54512", "odometerUnit": "mi", "motTestNumber": "284505820558"}, {"completedDate": "2019.04.01 10:20:20", "testResult": "PASSED", "expiryDate": "2020.04.10", "odometerValue": "52402", "odometerUnit": "mi", "motTestNumber": "318583668051"}, {"completedDate": "2018.04.05 10:28:31", "testResult": "PASSED", "expiryDate": "2019.04.10", "odometerValue": "49647", "odometerUnit": "mi", "motTestNumber": "601004987953"}, {"completedDate": "2017.03.30 07:39:30", "testResult": "PASSED", "expiryDate": "2018.04.10", "odometerValue": "47483", "odometerUnit": "mi", "motTestNumber": "929220956187"}, {"completedDate": "2016.03.30 11:08:11", "testResult": "PASSED", "expiryDate": "2017.04.10", "odometerValue": "45234", "odometerUnit": "mi", "motTestNumber": "538041719835"}, {"completedDate": "2016.03.30 07:52:32", "testResult": "FAILED", "odometerValue": "45234", "odometerUnit": "mi", "motTestNumber": "666255428679"}, {"completedDate": "2015.03.31 09:42:13", "testResult": "PASSED", "expiryDate": "2016.04.10", "odometerValue": "42096", "odometerUnit": "mi", "motTestNumber": "785600695062"}, {"completedDate": "2014.03.31 10:55:48", "testResult": "PASSED", "expiryDate": "2015.04.10", "odometerValue": "39592", "odometerUnit": "mi", "motTestNumber": "497360994018"}, {"completedDate": "2013.04.10 15:54:05", "testResult": "PASSED", "expiryDate": "2014.04.10", "odometerValue": "36816", "odometerUnit": "mi", "motTestNumber": "327980303199"}, {"completedDate": "2013.04.10 11:27:00", "testResult": "FAILED", "odometerValue": "36816", "odometerUnit": "mi", "motTestNumber": "866250103122"}, {"completedDate": "2012.04.10 12:18:19", "testResult": "PASSED", "expiryDate": "2013.04.10", "odometerValue": "33955", "odometerUnit": "mi", "motTestNumber": "196701502133"}, {"completedDate": "2011.04.11 16:25:13", "testResult": "PASSED", "expiryDate": "2012.04.10", "odometerValue": "30997", "odometerUnit": "mi", "motTestNumber": "296421101482"}, {"completedDate": "2011.04.09 09:47:35", "testResult": "FAILED", "odometerValue": "30997", "odometerUnit": "mi", "motTestNumber": "486209991044"}, {"completedDate": "2010.03.12 13:46:56", "testResult": "PASSED", "expiryDate": "2011.03.31", "odometerValue": "26972", "odometerUnit": "mi", "motTestNumber": "723581170080"}, {"completedDate": "2010.03.11 12:13:33", "testResult": "FAILED", "odometerValue": "26972", "odometerUnit": "mi", "motTestNumber": "173390570005"}, {"completedDate": "2009.03.12 11:46:15", "testResult": "PASSED", "expiryDate": "2010.03.31", "odometerValue": "23061", "odometerUnit": "mi", "motTestNumber": "300131879046"}, {"completedDate": "2008.03.11 14:58:26", "testResult": "PASSED", "expiryDate": "2009.03.31", "odometerValue": "19210", "odometerUnit": "mi", "motTestNumber": "724361178021"}, {"completedDate": "2007.03.20 10:56:02", "testResult": "PASSED", "expiryDate": "2008.03.31", "odometerValue": "15287", "odometerUnit": "mi", "motTestNumber": "771359177069"}, {"completedDate": "2006.03.15 08:14:41", "testResult": "PASSED", "expiryDate": "2007.03.31", "odometerValue": "11520", "odometerUnit": "mi", "motTestNumber": "391414076043"}], "pageProps_vehicle_mot_motStatus": [{"value": "Valid", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_motExpiryDate": [{"value": "2025-08-12", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_motPassPercent": [{"value": "69", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_failedMotCount": [{"value": "8", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_cleansheet": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_recentMileage": [{"value": "63250", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_mot_passedMotCount": [{"value": "18", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_tax_taxStatus": [{"value": "Taxed", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_tax_taxDueDate": [{"value": "2025-03-01", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_dateOfLastV5CIssued": [{"value": "2024-09-23", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_fuelType": [{"value": "DIESEL", "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_vehicle_ulez": [{"value": null, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_scores_score": [{"value": 209, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_scores_averageScore": [{"value": 418, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_custom_viewedDatesCount": [{"value": 9, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_custom_badMessages": ["Over 20 comments on recent MOT's", "Over 2 fail comments on recent MOT's", "Vehicle is over 10 years old", "Average mileage is very low for a diesel"], "pageProps_custom_goodMessages": ["Mileage is between 50,000 & 80,000"], "pageProps_custom_legitMileage": [{"value": true, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_custom_scrappedMileage": [{"value": 104226, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_details_age": [{"message": "The vehicle is over 10 years old therefore may experience age related reliability issues soon, which has effected the score negatively", "points": "120-160"}], "pageProps_details_mot": [{"message": "There has been major comments in the past few years on MOT's", "points": "480-520"}], "pageProps_details_mileage": [{"message": "The mileage is still considered low", "points": "+5-15"}], "pageProps_details_avgMileage": [{"message": "This vehicle has a Diesel engine and has a yearly average mileage of under 4,000 which shows the vehicle has been stood still, or has done short journeys, both which are bad for Diesel engines.", "points": "70-80"}], "pageProps_details_motComments": [{"message": "underside corrosion", "points": "0"}], "pageProps_brandNewScores_age": [{"value": 10, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_brandNewScores_usage": [{"value": 11, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_brandNewScores_mileage": [{"value": 185, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_brandNewScores_motHistory": [{"value": 3, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_brandNewScores_score": [{"value": 209, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_reportsFound": [], "pageProps_shared": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_ulez": [{"value": false, "created_at": "2024-10-01T18:02:08.251577"}], "pageProps_scoresHistory": [{"score": 209, "date": "2024.08.13 08:40:46"}, {"score": 209, "date": "2022.09.06 15:19:27"}, {"score": 209, "date": "2022.08.11 15:43:45"}, {"score": 209, "date": "2022.03.23 11:21:17"}, {"score": 315, "date": "2021.04.08 09:04:13"}, {"score": 359, "date": "2021.04.08 09:04:12"}, {"score": 430, "date": "2020.03.20 12:18:51"}, {"score": 452, "date": "2020.03.20 12:18:50"}, {"score": 573, "date": "2019.04.01 10:20:20"}, {"score": 592, "date": "2018.04.05 10:28:31"}, {"score": 559, "date": "2017.03.30 07:39:30"}, {"score": 559, "date": "2016.03.30 11:08:11"}, {"score": 559, "date": "2016.03.30 07:52:32"}, {"score": 559, "date": "2015.03.31 09:42:13"}, {"score": 592, "date": "2014.03.31 10:55:48"}, {"score": 603, "date": "2013.04.10 15:54:05"}, {"score": 510, "date": "2013.04.10 11:27:00"}, {"score": 554, "date": "2012.04.10 12:18:19"}, {"score": 548, "date": "2011.04.11 16:25:13"}, {"score": 548, "date": "2011.04.09 09:47:35"}, {"score": 655, "date": "2010.03.12 13:46:56"}, {"score": 655, "date": "2010.03.11 12:13:33"}, {"score": 660, "date": "2009.03.12 11:46:15"}, {"score": 660, "date": "2008.03.11 14:58:26"}, {"score": 671, "date": "2007.03.20 10:56:02"}, {"score": 671, "date": "2006.03.15 08:14:41"}, {"score": 990, "date": "2003.03.31"}], "__N_SSP": [{"value": true, "created_at": "2024-10-01T18:02:08.251577"}], "vrm": [{"value": "ak03eww", "created_at": "2024-10-01T18:02:08.251577"}], "vin": [{"value": "WF0LMBD202W307673", "created_at": "2024-10-01T18:02:08.251577"}], "brandName": [{"value": "FORD", "created_at": "2024-10-01T18:02:08.251577"}], "model": [{"value": "RANGER", "created_at": "2024-10-01T18:02:08.251577"}], "damages": [{"value": [], "created_at": "2024-10-03T05:01:22.486566"}], "theft": [{"value": null, "created_at": "2024-10-01T18:02:08.251577"}], "fuelType": [{"value": null, "created_at": "2024-10-01T18:02:08.251577"}], "l/100km": [{"value": "", "created_at": "2024-10-01T18:02:08.251577"}], "mpg": [{"value": "", "created_at": "2024-10-01T18:02:08.251577"}], "Car length": [{"value": 5012, "created_at": "2024-10-01T18:02:08.251577"}], "Drive type": [{"value": "4x2", "created_at": "2024-10-01T18:02:08.251577"}], "Fuel tank capacity": [{"value": 70, "created_at": "2024-10-01T18:02:08.251577"}], "Height": [{"value": 1615, "created_at": "2024-10-01T18:02:08.251577"}], "Model variant": [{"value": "Ranger Diesel", "created_at": "2024-10-01T18:02:08.251577"}], "Number of axles": [{"value": 2, "created_at": "2024-10-01T18:02:08.251577"}], "Number of doors": [{"value": 2, "created_at": "2024-10-01T18:02:08.251577"}], "Number of gears": [{"value": 5, "created_at": "2024-10-01T18:02:08.251577"}], "Unladen weight": [{"value": 1450, "created_at": "2024-10-01T18:02:08.251577"}], "Wheel base": [{"value": 2985, "created_at": "2024-10-01T18:02:08.251577"}], "Width": [{"value": 1700, "created_at": "2024-10-01T18:02:08.251577"}], "Number of cylinders": [{"value": 4, "created_at": "2024-10-01T18:02:08.251577"}], "Fuel system": [{"value": "D Ind Turbo Cat", "created_at": "2024-10-01T18:02:08.251577"}], "Aspiration": [{"value": "Naturally Aspirated", "created_at": "2024-10-01T18:02:08.251577"}], "Fuel type": [{"value": "Diesel", "created_at": "2024-10-01T18:02:08.251577"}], "Type approval category": [{"value": "N1", "created_at": "2024-10-01T18:02:08.251577"}], "Driving axle": [{"value": "FWD", "created_at": "2024-10-01T18:02:08.251577"}], "Series description": [{"value": "MK2", "created_at": "2024-10-01T18:02:08.251577"}], "Euro status": [{"value": 3, "created_at": "2024-10-01T18:02:08.251577"}], "Torque (ftLb)": [{"value": "", "created_at": "2024-10-01T18:02:08.251577"}], "Torque (nm)": [{"value": "", "created_at": "2024-10-01T18:02:08.251577"}], "Power (kw)": [{"value": 62, "created_at": "2024-10-01T18:02:08.251577"}], "Power (bhp)": [{"value": 83, "created_at": "2024-10-01T18:02:08.251577"}], "Top speed (kph)": [{"value": 140, "created_at": "2024-10-01T18:02:08.251577"}], "Top speed (mph)": [{"value": "", "created_at": "2024-10-01T18:02:08.251577"}], "created_at": "2024-10-01T18:02:08.251577", "updated_at": "2024-10-03T05:01:22.486566", "searched": []}}
        """
        
        result = ai.process_input(input)
        print("AI's thoughts:")
        print(result)
    except Exception as e:
        logger.write(f"Error in main execution: {str(e)}", is_exception=True)

# TODO - Gather enough data to train a local model

